# MongoDB

In order to store the notes permanently, we need a database. Relational databases have been used in most courses of the Department of Computer Science. In almost all parts of this course we use MongoDB , which is the so-called <a href="https://en.wikipedia.org/wiki/Document-oriented_database" target="_blank">document database</a>.

- The main reason for using Mongo in the course is that Mongo is easier to use than relational databases for database geeks. Part 13 of the course introduces you to making node applications that use relational databases.

- Document databases differ to some extent from relational databases both in terms of the way they organize the data and the query language. Document databases are thought to fall under the umbrella term `NoSQL` . A short introduction to document databases is here .

- Now read the linked introduction . In the following, it is assumed that you master the concepts of document and collection .

## Document databases, e.g. MongoDB

- Document databases can be thought of as somewhere between relational databases and key-value databases

- Document databases, like key-value databases, are based on storing values ​​based on a key.

- However, values ​​or documents, as they are called in the context of document bases, can be very complex objects in themselves, which contain fields, the value of which can be either normal values ​​such as numbers and strings or other objects. 

- Unlike key-value databases, document databases "see" inside the documents stored in the database, and enable queries made regarding the contents of the stored documents.

- In the following, the entries of the most popular document database, MongoDB, will be used as an example.

- JSON is usually used as the logical representation of information in document databases . Below is the JSON document presenting the course Fundamentals of Programming :

```json 
{
  "id": ObjectId("10"),
  "nimi": "Ohjelmistotekniikka",
  "laajuus": 5,
  "luennot": [ "Matti Luukkainen" ]
}
```

- A JSON document consists of key-value pairs. The value corresponding to the key is marked with a colon, separated from the key.

- The course document therefore has four key-value pairs. It can be thought that the course has four fields. Among these fields, the special position is the key field automatically generated by MongoDB for the document, `id` the value of which is of type `ObjectId`. **What differs from relational databases is that the value of the field can be a table**.

- The following is a document describing the student:

```json
{
  "id" : ObjectId("59"),
  "nimi" : "Pekka Mikkola",
  "opiskelijanumero" : 14112345,
  "osoite" : {
                "katu" : "Tehtaankatu 10 B 1",
                "postinumero" : "00120",
                "postitoimipaikka" : "Helsinki"
             }
}
```

- Now the value of the field address is an object that has its own fields.

- **In the document database, the documents are sorted into collections** . The meaning of a collection is roughly the same as in a table's relational database. However, the documents in one collection do not have to be the same in terms of fields. There can be a variable number of fields, and fields with the same name can contain a different type of value in different documents. No schema of any kind is defined for the collections in the document databases, i.e. it is entirely the responsibility of the applications that reasonable data is stored in the database, and that the data read from the database is examined correctly.

- As we saw above with the student, it is possible to include objects within each other in document databases. The situation could also have been modeled like a "relational model" so that there would be its own collection for addresses, and a single address would be modeled as its own document:

```json
{
  "id" : ObjectId("123"),
  "katu" : "Tehtaankatu 10 B 1",
  "postinumero" : "00120",
  "postitoimipaikka" : "Helsinki"
}
```

- The student document would now only contain a reference to the address document:

```json
{
  "id" : ObjectId("59"),
  "nimi" : "Pekka Mikkola",
  "opiskelijanumero" : 14112345,
  "osoite" : ObjectId("123")
}
```

- Unlike in the case of relational databases, document databases do not offer join operations at the database level , and in the case of the previous example, the application itself would have to ensure that when searching for a student, the student's address is also retrieved from the database.

- Although the operation is not supported at the document base level, there are many libraries that implement the join operation programmatically so that the application program does not have to worry about it.

- In relational databases, creating a base schema is so easy that when aiming for a normalized solution, in most situations there is about one "sensible" solution that works almost equally well regardless of how the base is used.

- The situation is different when it comes to documentary stocks. Let's examine, for example, Courses and Students' course performance. In the relational database, the situation would be straightforward, the Performance would be the Course and Student connection table.

<a href="https://www.mongodb.com/docs/manual/faq/fundamentals/#:~:text=Instead%20of%20tables%2C%20a%20MongoDB,in%20a%20relational%20database%20table." target="_blank">collections and document</a>

- You can install MongoDB locally on your computer. However, there are also Mongos operating as a service on the Internet, of which the best choice at the moment is <a href="https://www.mongodb.com/atlas/database" target="_blank">MongoDB Atlas</a> .

- After the user account has been created and logged in, Let's start by choosing the free option suitable for trials

- This will create Project zero and also cluster to get started with mongoDb. In addition to this, we have to define the IP addresses that are allowed access to the database. For the sake of simplicity we will allow access from all IP addresses:

- Note: In case the modal menu is different for you, according to MongoDB documentation, adding 0.0.0.0 as an IP allows access from anywhere as well.

- Finally, we are ready to connect to our database. Start by clicking connect and choose: Connect your application

- The view displays the MongoDB URI , which is the address of the database that we will supply to the MongoDB client library we will add to our application. The address will look like this:
```
mongodb+srv://fullstack:<password>@cluster0.o1opl.mongodb.net/?retryWrites=true&w=majority
```

- We could use the database directly from our JavaScript code with the official MongoDB Node.js driver library, but it is quite cumbersome to use. We will instead use the Mongoose library that offers a higher-level API.

```
npm install mongoose
```

- Let's not add any code dealing with Mongo to our backend just yet. Instead, Let's make a practice application by creating a new file, mongo.js :

```js
const mongoose = require('mongoose')

if (process.argv.length<3) {
  console.log('give password as argument')
  process.exit(1)
}

const password = process.argv[2]

const url =
  `mongodb+srv://fullstack:${password}@cluster0.o1opl.mongodb.net/?retryWrites=true&w=majority`

mongoose.set('strictQuery',false)
mongoose.connect(url)

const noteSchema = new mongoose.Schema({
  content: String,
  important: Boolean,
})

const Note = mongoose.model('Note', noteSchema)

const note = new Note({
  content: 'HTML is Easy',
  important: true,
})

note.save().then(result => {
  console.log('note saved!')
  mongoose.connection.close()
})
```

- The code also assumes that it will be passed the password from the credentials we created in MongoDB Atlas, as a command line parameter. We can access the command line parameter like this:

```js
const password = process.argv[2]
```

- When the code is run with the command node mongo.js password, Mongo will add a new document to the database.

><strong>NOTE</strong>: Please note the password is the password created for the database user, not your MongoDB Atlas password. Also, if you created a password with special characters, then you'll need to <a href="https://www.mongodb.com/docs/atlas/troubleshoot-connection/#special-characters-in-connection-string-password">URL encode</a> that password.


- We can view the current state of the database from the MongoDB Atlas from Browse collections, in the Database tab.

<img src="./collections.png" alt="mongodb.com collections tab inside cluster">

- you can delete the `test` database and provide a custom name for the database from the connect url

```
const url =
  `mongodb+srv://example:${password}@cluster0.o1opl.mongodb.net/noteApp?retryWrites=true&w=majority`
```

- the above will create a db with a name <strong>noteApp</strong>



